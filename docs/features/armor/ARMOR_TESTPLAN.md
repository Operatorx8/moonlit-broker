# ARMOR_TESTPLAN.md - 盔甲系统测试清单

> 进游戏怎么验，一次性验证完

---

## 测试环境准备

```bash
# 测试命令（复制到游戏内执行）

# 获取所有头盔
/give @s xqanzd_moonlit_broker:sentinel_helmet
/give @s xqanzd_moonlit_broker:silent_oath_helmet
/give @s xqanzd_moonlit_broker:exile_mask_helmet
/give @s xqanzd_moonlit_broker:relic_circlet_helmet
/give @s xqanzd_moonlit_broker:retracer_ornament_helmet

# 获取所有胸甲
/give @s xqanzd_moonlit_broker:old_market_chestplate
/give @s xqanzd_moonlit_broker:blood_pact_chestplate
/give @s xqanzd_moonlit_broker:ghost_god_chestplate
/give @s xqanzd_moonlit_broker:windbreaker_chestplate
/give @s xqanzd_moonlit_broker:void_devourer_chestplate

# 获取所有护腿
/give @s xqanzd_moonlit_broker:smuggler_shin_leggings
/give @s xqanzd_moonlit_broker:smuggler_pouch_leggings
/give @s xqanzd_moonlit_broker:graze_guard_leggings
/give @s xqanzd_moonlit_broker:stealth_shin_leggings
/give @s xqanzd_moonlit_broker:clear_ledger_leggings

# 获取所有靴子
/give @s xqanzd_moonlit_broker:untraceable_treads_boots
/give @s xqanzd_moonlit_broker:boundary_walker_boots
/give @s xqanzd_moonlit_broker:ghost_step_boots
/give @s xqanzd_moonlit_broker:marching_boots
/give @s xqanzd_moonlit_broker:gossamer_boots

# 召唤测试怪物
/summon zombie ~ ~ ~
/summon skeleton ~ ~ ~
/summon creeper ~ ~ ~
/summon enderman ~ ~ ~
/summon wither_skeleton ~ ~ ~

# 设置时间/天气
/time set night
/weather clear

# 生命值操作
/effect give @s instant_damage 1 0
/effect give @s instant_health 1 0

# 交易测试
/summon wandering_trader ~ ~ ~

# 清除冷却（如有调试命令）
/merchant_armor clear_cooldown @s all
```

---

## 通用测试

### 物品基础

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| A-01 | 物品注册 | `/give` 命令 | 成功获取物品 | [ ] |
| A-02 | 物品名称 | 查看物品 | 显示正确中文名 + 与 rarity 匹配的名称颜色 | [ ] |
| A-03 | 物品 Lore | 查看物品 | 显示英文 Lore + 效果描述 | [ ] |
| A-04 | 物品贴图 | 查看物品 | 正确贴图，非紫黑块 | [ ] |
| A-05 | 穿戴槽位 | 穿戴 | 只能穿戴到对应槽位（头/胸/腿/脚） | [ ] |
| A-06 | 穿戴模型 | 穿戴并查看 | 角色模型正确显示盔甲 | [ ] |
| A-07 | 护甲值 | 穿戴查看 UI | 护甲 UI +3 | [ ] |

### 附魔系数验收（enchantability）

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| A-E01 | UNCOMMON 档位 | 用 `sentinel_helmet` 与原版铁头盔在附魔台各附魔 10 次 | 可选附魔等级与高等级词条出现频率接近 | [ ] |
| A-E02 | RARE 档位 | 用 `silent_oath_helmet`（或 `exile_mask_helmet`）与原版锁链头盔对照附魔 | 结果分布接近锁链头盔 | [ ] |
| A-E03 | EPIC 档位 | 用 `retracer_ornament_helmet` 与原版下界合金头盔对照附魔 | 结果分布接近下界合金头盔 | [ ] |
| A-E04 | 铁砧边界 | 给上述头盔附同一本附魔书并比较铁砧花费 | 花费由附魔/修复规则决定，不受 enchantability 直接影响 | [ ] |

### 生命周期

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| A-08 | 脱下效果消失 | 脱下流亡面甲 | 攻击力加成消失 | [ ] |
| A-09 | 死亡后重置 | 穿戴死亡重生 | 冷却重置，效果消失 | [ ] |
| A-10 | 切换维度 | 穿戴进入下界 | 效果正常工作 | [ ] |
| A-11 | 重进世界 | 断线重连 | 状态正确恢复 | [ ] |

---

## 头盔 1: 哨兵的最后瞭望

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S1-01 | 黑暗 + 敌对触发 | 穿戴，光照 ≤7，16 格内放敌对生物并等待扫描 | 玩家获得 Speed I（约 1.5s）并听到提示音；敌对生物无 Glowing 轮廓 | [ ] |
| S1-02 | 冷却生效 | 首次触发后 40 秒内反复满足条件 | 不重复触发（无重复音效/无重复 Speed） | [ ] |
| S1-03 | 非黑暗不触发 | 穿戴，站在明亮环境（光照 > 7），附近有敌对 | 不触发 | [ ] |
| S1-04 | 无敌对不触发 | 穿戴，光照 ≤7，但 16 格内无敌对 | 不触发 | [ ] |
| S1-05 | 触发范围边界 | 敌对在 17 格外 | 不触发 | [ ] |
| S1-06 | 触发范围边界 | 敌对在 16 格内 | 触发 Echo Pulse | [ ] |
| S1-07 | 性能频率 | 观察日志时间戳或 tick 计数 | 扫描频率为每 20 ticks（或更低），不得每 tick 全量扫描 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S1-L1 | 触发成功 | `action=trigger result=OK effect=sentinel_echo_pulse` | [ ] |
| S1-L2 | 光照不足 | `result=BLOCKED reason=not_dark` | [ ] |
| S1-L3 | 冷却中 | `result=BLOCKED reason=cd_hit cd_left=xxx` | [ ] |
| S1-L4 | 应用成功 | `action=apply result=OK effect=speed final{dur=30 amp=0} sound=minecraft:block.bell.use` | [ ] |

---

## 头盔 2: 沉默之誓约

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S2-01 | 减伤触发 | 穿戴，被僵尸攻击 | 伤害减少 2 点 | [ ] |
| S2-02 | 低伤害不触发 | 被伤害 < 2 的攻击 | 不触发减伤 | [ ] |
| S2-03 | 非怪物不触发 | 摔落伤害 / 熔岩 | 不触发减伤 | [ ] |
| S2-04 | 激怒怪物触发 | 被激怒的僵尸猪人攻击 | 触发减伤 | [ ] |
| S2-05 | 冷却生效 | 触发后再次受攻击 | 30 秒内不触发 | [ ] |
| S2-06 | 冷却结束 | 等待 30 秒后受攻击 | 再次触发 | [ ] |

### 数值验证

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S2-N1 | 减伤计算 | 被 5 点伤害攻击 | 实际受到 3 点 | [ ] |
| S2-N2 | 最小伤害 | 被 2 点伤害攻击 | 实际受到 0 点 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S2-L1 | 触发成功 | `action=trigger result=OK effect=silent_oath_reduction` | [ ] |
| S2-L2 | 伤害修改 | `action=damage_modify final{amount=3.0} src{original=5.0}` | [ ] |
| S2-L3 | 非敌对 | `result=BLOCKED reason=damage_not_hostile` | [ ] |

---

## 头盔 3: 流亡者的面甲

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S3-01 | 高血量无加成 | 穿戴，满血 | 攻击力不变 | [ ] |
| S3-02 | 低血量有加成 | 穿戴，血量 < 50% | 攻击力增加 | [ ] |
| S3-03 | 加成实时更新 | 持续掉血 | 攻击力随血量下降增加 | [ ] |
| S3-04 | 加成有上限 | 血量降到 10% | 攻击力不超过 +4.0 | [ ] |
| S3-05 | 回血后消失 | 吃东西回血到 50%+ | 攻击力加成消失 | [ ] |
| S3-06 | 脱下后消失 | 脱下头盔 | 攻击力恢复原值 | [ ] |

### 数值验证

| # | 测试项 | 血量% | 预期增伤 | 通过 |
|---|--------|-------|----------|------|
| S3-N1 | 50% | 50% | +0 | [ ] |
| S3-N2 | 42.5% | 42.5% | +1.0 | [ ] |
| S3-N3 | 35% | 35% | +2.0 | [ ] |
| S3-N4 | 27.5% | 27.5% | +3.0 | [ ] |
| S3-N5 | 20% | 20% | +4.0 | [ ] |
| S3-N6 | 10% | 10% | +4.0 (上限) | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S3-L1 | 状态激活 | `state=exile_mask_active enabled=true` | [ ] |
| S3-L2 | 属性更新 | `action=attribute_update attr=generic.attack_damage` | [ ] |
| S3-L3 | 状态解除 | `state=exile_mask_active enabled=false` | [ ] |

---

## 头盔 4: 遗世之环

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S4-01 | 首次锁定触发 | 穿戴，被僵尸首次锁定 | 获得 Absorption | [ ] |
| S4-02 | 持续锁定不触发 | 同一僵尸持续追击 | 不重复触发 | [ ] |
| S4-03 | 护盾持续时间 | 触发后计时 | Absorption 持续约 3 秒 | [ ] |
| S4-04 | 冷却生效 | 触发后被另一僵尸锁定 | 30 秒内不触发 | [ ] |
| S4-05 | 末影人兼容 | 被末影人激怒 | 触发效果 | [ ] |
| S4-06 | 猪灵兼容 | 被猪灵激怒 | 触发效果 | [ ] |

### 边沿触发验证

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S4-E1 | 怪物脱战后重置 | 僵尸失去目标后再次锁定 | 可再次触发（受 CD 限制） | [ ] |
| S4-E2 | 怪物死亡后重置 | 杀死僵尸，新僵尸锁定 | 可触发（受 CD 限制） | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S4-L1 | 触发成功 | `action=trigger result=OK effect=relic_circlet_shield first_target=true` | [ ] |
| S4-L2 | 已触发过 | `result=BLOCKED reason=already_triggered` | [ ] |

---

## 头盔 5: 回溯者的额饰

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S5-01 | 爆炸致死保护 | 穿戴，低血量被苦力怕炸 | 存活，血量 = 1♥ | [ ] |
| S5-02 | 短暂保护 | 触发后 | 有短暂抗性效果 | [ ] |
| S5-03 | 非爆炸不触发 | 被僵尸打致死 | 正常死亡 | [ ] |
| S5-04 | 非致死不触发 | 高血量被爆炸 | 不触发，正常受伤 | [ ] |
| S5-05 | 图腾优先 | 持有图腾，被炸致死 | 图腾触发，额饰不触发 | [ ] |
| S5-06 | 无图腾时触发 | 不持图腾，被炸致死 | 额饰触发 | [ ] |
| S5-07 | 冷却生效 | 触发后再次被炸致死 | 15 分钟内正常死亡 | [ ] |
| S5-08 | 音效/粒子 | 触发时 | 有独特音效和粒子 | [ ] |

### 爆炸类型测试

| # | 测试项 | 爆炸来源 | 预期结果 | 通过 |
|---|--------|----------|----------|------|
| S5-E1 | 苦力怕 | Creeper | 触发保护 | [ ] |
| S5-E2 | TNT | TNT | 触发保护 | [ ] |
| S5-E3 | 床（下界） | Bed | 触发保护 | [ ] |
| S5-E4 | 水晶 | End Crystal | 触发保护 | [ ] |
| S5-E5 | 凋灵骷髅头 | Wither Skull | 触发保护 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S5-L1 | 触发成功 | `action=trigger result=OK effect=retracer_save dmg_type=explosion` | [ ] |
| S5-L2 | 死亡阻止 | `action=apply effect=death_prevention final{health_set=2.0}` | [ ] |
| S5-L3 | 图腾优先 | `result=BLOCKED reason=totem_active` | [ ] |
| S5-L4 | 非爆炸 | `result=BLOCKED reason=damage_not_explosion` | [ ] |

---

---

## 胸甲 1: 旧市护甲

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C1-01 | 交易经验触发 | 穿戴，与商人完成首次交易 | 50% 概率获得额外 50% 经验 | [ ] |
| C1-02 | 交易首次槽限定 | 同一交易槽重复交易 | 仅首次可触发，后续不触发 | [ ] |
| C1-03 | 交易冷却 | 触发后 60s 内完成其他交易槽 | CD 期间不触发 | [ ] |
| C1-04 | 击杀经验触发 | 穿戴，击杀怪物 | 25% 概率获得额外 100% 经验 | [ ] |
| C1-05 | 击杀冷却 | 触发后 30s 内再次击杀 | CD 期间不触发 | [ ] |
| C1-06 | 双通道独立 | 交易触发后立即击杀 | 击杀通道不受交易 CD 影响 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| C1-L1 | 交易触发 | `effect=old_market_trade_xp rng{...hit=YES}` | [ ] |
| C1-L2 | 击杀触发 | `effect=old_market_kill_xp rng{...hit=YES}` | [ ] |
| C1-L3 | 交易已触发 | `reason=trade_already_triggered` | [ ] |

---

## 胸甲 2: 流血契约之胸铠

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C2-01 | 受击储能 | 穿戴，被怪物攻击 | 50% 概率额外扣血并储能 | [ ] |
| C2-02 | 储能上限 | 连续受击多次 | 池不超过 4♥ (8.0 HP) | [ ] |
| C2-03 | 攻击释放 | 储能后攻击怪物 | 池中伤害追加到攻击 | [ ] |
| C2-04 | 释放后清空 | 攻击后查看池 | 池归零 | [ ] |
| C2-05 | 窗口过期 | 储能后等待 10s+ 再攻击 | 池过期清空，不追加伤害 | [ ] |
| C2-06 | 伤害源限定 | 被火焰/熔岩/爆炸伤害 | 不触发储能 | [ ] |

### 数值验证

| # | 测试项 | 原始伤害 | 额外扣血 | 池增加 | 通过 |
|---|--------|----------|----------|--------|------|
| C2-N1 | 普通伤害 | 6.0 | 3.0 (50%) | +3.0 | [ ] |
| C2-N2 | 高伤害 | 10.0 | 4.0 (上限 2♥) | +4.0 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| C2-L1 | 储能成功 | `effect=blood_pact extra_dmg=X pool{...}` | [ ] |
| C2-L2 | 释放成功 | `effect=blood_pact_release pool=X` | [ ] |
| C2-L3 | 池过期 | `reason=pool_expired` | [ ] |

---

## 胸甲 3: 鬼神之铠

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C3-01 | 亡灵减伤 | 穿戴，被僵尸攻击 | 30% 概率伤害 -15% | [ ] |
| C3-02 | 非亡灵不触发 | 被蜘蛛攻击 | 不触发减伤 | [ ] |
| C3-03 | Boss 概率减半 | 被凋灵攻击 | 15% 概率减伤 | [ ] |
| C3-04 | Wither Debuff 免疫 | 被凋灵骷髅施加凋零 | 50% 概率免疫 | [ ] |
| C3-05 | Hunger Debuff 免疫 | 被亡灵施加饥饿 | 50% 概率免疫 | [ ] |
| C3-06 | Slowness Debuff 免疫 | 被亡灵施加缓慢 | 50% 概率免疫 | [ ] |
| C3-07 | Boss Debuff 概率减半 | 被凋灵施加凋零 | 25% 概率免疫 | [ ] |
| C3-08 | 非亡灵 Debuff 不免疫 | 被女巫施加缓慢 | 不触发免疫 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| C3-L1 | 减伤触发 | `effect=ghost_god_damage rng{...hit=YES}` | [ ] |
| C3-L2 | Debuff 免疫 | `effect=ghost_god_debuff debuff=wither` | [ ] |
| C3-L3 | 非亡灵 | `reason=not_undead` | [ ] |

---

## 胸甲 4: 商人的防风衣

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C4-01 | 击退抗性 | 穿戴，被怪物攻击 | 击退距离明显减少 | [ ] |
| C4-02 | 击退抗性值 | F3 查看属性或对比测试 | +0.3 击退抗性 | [ ] |
| C4-03 | 低血边沿触发 | 血量从 ≥50% 跌到 <50% | 获得 Speed I 5s | [ ] |
| C4-04 | 冷却生效 | 触发后回血再掉血 | 90s 内不重复触发 | [ ] |
| C4-05 | 解锁条件 | 触发后血量回到 60%+ | 状态解锁，可再次触发 | [ ] |
| C4-06 | 未解锁不触发 | 触发后血量未回 60%，再次掉到 50% 以下 | 不触发 | [ ] |
| C4-07 | 脱下后移除 | 脱下胸甲 | 击退抗性消失 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| C4-L1 | 边沿触发 | `effect=windbreaker_speed edge{from=0.5X to=0.4X}` | [ ] |
| C4-L2 | 解锁状态 | `state=rearm_ready enabled=true health_pct=0.6X` | [ ] |
| C4-L3 | 未解锁 | `reason=not_rearmed` | [ ] |

---

## 胸甲 5: 虚空之噬

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C5-01 | 真伤触发 | 穿戴，攻击怪物 | 追加 4% 真实伤害 | [ ] |
| C5-02 | 冷却生效 | 触发后 5s 内再次攻击 | 不追加真伤 | [ ] |
| C5-03 | 冷却结束 | 等待 5s 后攻击 | 再次追加真伤 | [ ] |
| C5-04 | Boss 比例减半 | 攻击末影龙/凋灵 | 仅追加 2% 真伤 | [ ] |
| C5-05 | 非 LivingEntity 不触发 | 攻击盔甲架/船 | 不触发 | [ ] |

### 数值验证

| # | 测试项 | 基础伤害 | 预期真伤 | 通过 |
|---|--------|----------|----------|------|
| C5-N1 | 普通目标 | 10.0 | 0.4 (4%) | [ ] |
| C5-N2 | Boss 目标 | 10.0 | 0.2 (2%) | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| C5-L1 | 触发成功 | `effect=void_devourer ctx{...base_dmg=X}` | [ ] |
| C5-L2 | 真伤应用 | `effect=true_damage final{amount=X ratio=0.04}` | [ ] |
| C5-L3 | Boss 模式 | `boss_modifier=true` | [ ] |

---

## 护腿 1: 走私者之胫

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| L1-01 | 掉落增益触发 | 穿戴后击杀普通怪 | 有概率触发额外 loot roll | [ ] |
| L1-02 | 双倍掉落触发 | 穿戴后连续击杀普通怪 | 有概率复制 1 个掉落物 | [ ] |
| L1-03 | 冷却生效 | 触发后 40s 内继续击杀 | CD 期间不触发任一子效果 | [ ] |
| L1-04 | PVP 排除 | 穿戴后击杀玩家 | 不触发掉落增益/双倍掉落 | [ ] |
| L1-05 | Boss/核心减半 | 击杀 Boss 或核心掉落目标 | 两项触发概率均减半 | [ ] |
| L1-06 | 组队一致性 | 双人各穿同护腿分别击杀 | 概率判定与 CD 互不串扰 | [ ] |
| L1-07 | 与胸甲叠加 | 同时穿旧市护甲 + 走私者之胫击杀 | 经验增益与掉落增益独立生效 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| L1-L1 | 额外掉落 | `effect=smuggler_loot_bonus rng{...}` | [ ] |
| L1-L2 | 双倍掉落 | `effect=smuggler_double_drop` | [ ] |
| L1-L3 | PVP 拦截 | `result=BLOCKED reason=pvp_excluded` | [ ] |

---

## 护腿 2: 走私者的暗袋

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| L2-01 | 正向吸附 | 地面放多个掉落物并穿戴等待 | 进入 5s 吸附期，物品自然靠近玩家 | [ ] |
| L2-02 | CD 生效 | 吸附触发后 35s 内重复场景 | CD 期间不再次启动吸附 | [ ] |
| L2-03 | 仅 ItemEntity | 同时存在经验球与掉落物 | 只吸掉落物，不吸经验球 | [ ] |
| L2-04 | 速度自然 | 观察轨迹 | 物品被牵引移动，不瞬移到脚下 | [ ] |
| L2-05 | 半径边界 | 5.9 格与 6.1 格对照 | 半径内生效，半径外不生效 | [ ] |
| L2-06 | 多人一致性 | 两玩家邻近同时触发 | 各自吸附目标稳定，无跨玩家抖动 | [ ] |
| L2-07 | 与头盔叠加 | 同时穿哨兵头盔 + 暗袋护腿 | 侦测与吸附互不阻塞 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| L2-L1 | 激活成功 | `effect=magnet_activate duration=100` | [ ] |
| L2-L2 | 激活中 | `state=magnet_active` | [ ] |
| L2-L3 | 到期结束 | `state=magnet_expired` | [ ] |

---

## 护腿 3: 擦身护胫

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| L3-01 | 正向触发 | 穿戴后被怪物/箭矢攻击 | 18% 概率触发 60% 减伤 | [ ] |
| L3-02 | CD 生效 | 触发后 12s 内继续受击 | CD 期间不重复触发 | [ ] |
| L3-03 | 非 Living 来源 | 火焰/摔落/窒息伤害 | 不触发擦身减伤 | [ ] |
| L3-04 | 边界伤害 | 记录原伤害与结算伤害 | 触发时结算值约为原值 40% | [ ] |
| L3-05 | 与其他装备叠加 | 同时穿戴减伤头盔/胸甲 | 互不覆盖，按链路顺序结算 | [ ] |
| L3-06 | 服务器一致性 | 联机环境持续受击样本 | 客户端显示与服务端伤害一致 | [ ] |

---

## 护腿 4: 潜行之胫

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| L4-01 | 充能节奏 | 穿戴后等待 45s | 获得 1 层垫层并提示 | [ ] |
| L4-02 | 最大层数 | 连续等待 90s+ | 层数最多 2，不继续累加 | [ ] |
| L4-03 | 门槛判定 | 触发摔落伤害 <3.0 HP | 不消耗垫层 | [ ] |
| L4-04 | 消耗判定 | 触发摔落伤害 >=3.0 HP | 消耗 1 层并减伤 80% | [ ] |
| L4-05 | CD/充能提示 | 消耗后再次等待 45s | 恢复 1 层并出现提示（ActionBar/音效） | [ ] |
| L4-06 | 多人一致性 | 双玩家分别消耗与充能 | 层数独立追踪，不串状态 | [ ] |
| L4-07 | 与胸甲叠加 | 同时穿防风衣 + 潜行之胫 | 低血速度与摔落减伤独立生效 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| L4-L1 | 充能成功 | `state=stealth_shin_charge charges=X` | [ ] |
| L4-L2 | 门槛拦截 | `result=BLOCKED reason=fall_damage_below_threshold` | [ ] |
| L4-L3 | 减伤消耗 | `effect=stealth_shin_fall_pad charges_left=X` | [ ] |

---

## 护腿 5: 清账步态

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| L5-01 | 首次触发 | 穿戴后击杀怪物 | 获得 Speed I 持续 3s | [ ] |
| L5-02 | CD 规则 | 触发后 16s 内继续击杀 | 不重置为 3s，仅在当前剩余上 +1s | [ ] |
| L5-03 | 时长上限 | CD 内连续击杀 | 总时长不超过 6s | [ ] |
| L5-04 | PVP 排除 | 击杀玩家 | 不触发速度效果 | [ ] |
| L5-05 | 边界对比 | 剩余 2.5s 时击杀 | 延长为 3.5s，不回退/重刷为 3s | [ ] |
| L5-06 | 多人一致性 | 双玩家并行击杀 | 各自 CD 与持续时间独立 | [ ] |
| L5-07 | 与胸甲叠加 | 同时穿虚空之噬 + 清账步态击杀 | 真伤与步态速度独立触发 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| L5-L1 | 首次触发 | `effect=clear_ledger_speed first_proc=true` | [ ] |
| L5-L2 | CD 内延长 | `effect=speed_extend add=20 cap=120` | [ ] |
| L5-L3 | PVP 拦截 | `result=BLOCKED reason=pvp_excluded` | [ ] |

---

## 靴子 1: 无追索步履

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| B1-01 | 脱战触发 | 穿戴后 12s 内不攻击且不被怪物命中 | 获得隐身 3s（无粒子） | [ ] |
| B1-02 | 冷却生效 | 首次触发后继续保持脱战 | 45s 内不重复触发 | [ ] |
| B1-03 | 攻击打断 | 触发前主动攻击怪物 | 计时重置，不触发隐身 | [ ] |
| B1-04 | 受击打断 | 触发前被怪物命中 | 计时重置，不触发隐身 | [ ] |
| B1-05 | 脱下清除 | 触发后立刻脱下靴子 | 效果不再刷新，状态重置 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| B1-L1 | 进入成功 | `action=enter ... bootId=xqanzd_moonlit_broker:untraceable_treads_boots` | [ ] |
| B1-L2 | 退出成功 | `action=exit ... bootId=xqanzd_moonlit_broker:untraceable_treads_boots` | [ ] |

---

## 靴子 2: 边界行走

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| B2-01 | 夜晚露天触发 | 主世界露天夜晚穿戴 | 持续获得 Jump Boost I（滚动刷新） | [ ] |
| B2-02 | 降水触发 | 主世界露天白天 + 下雨/雷暴 | 持续获得 Jump Boost I | [ ] |
| B2-03 | 室内不触发 | 主世界夜晚但屋顶遮挡天空 | 不触发 | [ ] |
| B2-04 | 维度限制 | 下界/末地穿戴 | 不触发 | [ ] |
| B2-05 | 条件离开 | 由露天进入室内 | 效果自然过期，不再刷新 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| B2-L1 | 进入成功 | `action=enter ... bootId=xqanzd_moonlit_broker:boundary_walker_boots` | [ ] |
| B2-L2 | 退出成功 | `action=exit ... bootId=xqanzd_moonlit_broker:boundary_walker_boots` | [ ] |

---

## 靴子 3: 幽灵步伐

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| B3-01 | 非战斗免推挤 | 穿戴后不攻击，进入实体密集区 | 实体不再推挤玩家 | [ ] |
| B3-02 | 战斗恢复推挤 | 攻击怪物后 8s 内进入实体密集区 | 可被推挤 | [ ] |
| B3-03 | 应急免推挤 | 1s 内被 LivingEntity 命中 2 次 | 触发 1s 应急免推挤 | [ ] |
| B3-04 | 应急冷却 | 连续制造 2-hit 场景 | 15s CD 内不重复触发 | [ ] |
| B3-05 | 条件恢复 | 攻击后等待 8s 不再攻击 | 常驻免推挤恢复 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| B3-L1 | 常驻状态切换 | `action=enter|exit ... bootId=xqanzd_moonlit_broker:ghost_step_boots` | [ ] |
| B3-L2 | 应急触发 | `action=enter ... expiresTick=... cdUntil=...` | [ ] |

---

## 靴子 4: 急行之靴

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| B4-01 | 进入急行 | 8s 不攻击 + 4s 不被 LivingEntity 命中 | 进入急行并获得 Speed II | [ ] |
| B4-02 | 攻击即时退出 | 急行期间命中怪物 | 立即退出急行并进入 12s CD | [ ] |
| B4-03 | 受击退出 | 急行期间被怪物命中 | 下一次扫描后退出急行 | [ ] |
| B4-04 | 超时退出 | 急行持续到 15s | 自动退出并进入 12s CD | [ ] |
| B4-05 | CD 结束重进 | 等待 12s 后再次满足条件 | 可重新进入急行 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| B4-L1 | 进入成功 | `action=enter ... bootId=xqanzd_moonlit_broker:marching_boots` | [ ] |
| B4-L2 | 退出成功 | `action=exit ... bootId=xqanzd_moonlit_broker:marching_boots` | [ ] |

---

## 靴子 5: 轻灵之靴

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| B5-01 | 蛛网减速减轻 | 穿戴后进入蜘蛛网 | 移动速度明显高于未穿戴 | [ ] |
| B5-02 | 缓慢降阶 | 给予玩家 Slowness II 后进入蜘蛛网 | 降为 Slowness I | [ ] |
| B5-03 | 非蛛网不触发 | 穿戴在普通地面移动 | 不发生速度修正 | [ ] |
| B5-04 | 离开蛛网过期 | 从蛛网走出后等待 | 效果自然过期（不再刷新） | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| B5-L1 | 进入成功 | `action=enter ... bootId=xqanzd_moonlit_broker:gossamer_boots` | [ ] |
| B5-L2 | 退出成功 | `action=exit ... bootId=xqanzd_moonlit_broker:gossamer_boots` | [ ] |

---

## 护腿 Bug 修复验证 (v0.11.1)

### 走私者之胫掉落采集修复

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| L1-F01 | 掉落采集 | 击杀普通僵尸 | 日志显示 `effect=smuggler_loot_bonus` 或 `smuggler_double_drop`，且额外物品确实生成 | [ ] |
| L1-F02 | 核心资源减半 | 击杀凋灵或使用 `/loot spawn` 生成含 `nether_star` 掉落 | 日志显示 `core=true`，概率减半（需多次验证） | [ ] |
| L1-F03 | core_loot tag | 检查 `data/xqanzd_moonlit_broker/tags/item/core_loot.json` 存在且格式正确 | 包含 5 个物品 ID | [ ] |

### 走私者暗袋 20t 节奏验证

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| L2-F01 | 激活期节奏 | 触发磁吸后观察日志 | `state=magnet_pull` 日志每 20 ticks 出现一次，不是每 tick | [ ] |
| L2-F02 | 拉取间隔 | DEBUG 模式观察 | 5 秒激活期内约拉取 5 次（100t / 20t = 5） | [ ] |

### 死亡/重生清理验证

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| L-R01 | 死亡后冷却重置 | 触发任一护腿效果进入 CD → 死亡 → 重生 → 立即触发 | 冷却已清除，可立即触发 | [ ] |
| L-R02 | 重生后状态清理 | 潜行之胫充满 2 层 → 死亡 → 重生 | 层数归零，需重新充能 | [ ] |
| L-R03 | 暗袋激活中死亡 | 触发暗袋激活 → 死亡 → 重生 | 激活状态清除，可重新触发 | [ ] |
| L-R04 | 清账步态死亡 | Speed 生效中死亡 → 重生 | 速度效果消失，CD 已重置 | [ ] |

### ClearLedger Speed 来源识别验证

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| L5-F01 | 外部 Speed 不误判 | 穿清账步态 → 喝 Speed 药水 → 击杀怪物 | 首杀获得 3s Speed（药水被覆盖或独立），CD 内击杀正确延长 | [ ] |
| L5-F02 | 效果过期判定 | 触发清账步态 → 等待 Speed 自然过期 → CD 内击杀 | 日志显示 `result=BLOCKED reason=cd_hit`，不触发延长 | [ ] |

---

## 胸甲附魔系数验收

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C-E01 | UNCOMMON 档位 | `windbreaker_chestplate` 与原版铁胸甲附魔对照 | 分布接近铁甲 | [ ] |
| C-E02 | RARE 档位 | `old_market_chestplate` 与原版锁链胸甲附魔对照 | 分布接近锁链甲 | [ ] |
| C-E03 | EPIC 档位 | `ghost_god_chestplate` 与原版下界合金胸甲附魔对照 | 分布接近下界合金甲 | [ ] |

---

## 边界情况

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| E-01 | 快速切换头盔 | 战斗中切换不同头盔 | 效果正确切换，无残留 | [ ] |
| E-02 | 与原版附魔共存 | 附魔保护 IV | 两者效果叠加 | [ ] |
| E-03 | 与药水共存 | 喝力量药水 + 流亡面甲 | 攻击力正确叠加 | [ ] |
| E-04 | 多人同时穿戴 | 两玩家穿同款头盔 | 各自独立触发 | [ ] |
| E-05 | 快速切换胸甲 | 战斗中切换不同胸甲 | 效果正确切换，无残留 | [ ] |
| E-06 | 头盔+胸甲组合 | 穿戴流亡面甲 + 血契胸甲 | 两者效果独立工作 | [ ] |
| E-07 | 血契+虚空组合 | 穿血契胸甲击中敌人 | 血契释放和虚空真伤分别生效 | [ ] |
| E-08 | 胸甲+护腿组合 | 穿戴旧市护甲 + 清账步态 | 经验与速度效果各自独立生效 | [ ] |
| E-09 | 头盔+护腿组合 | 穿戴哨兵头盔 + 走私者暗袋 | 侦测与吸附不互相吞事件 | [ ] |
| E-10 | 三件并行 | 头盔+胸甲+护腿同时触发 | CD 独立、日志可追踪且无串扰 | [ ] |
| E-11 | 护腿+靴子组合 | 穿戴潜行之胫 + 急行之靴 | 两者按各自规则生效，不互相覆盖 | [ ] |
| E-12 | 四件并行 | 头盔+胸甲+护腿+靴子同时触发 | 效果与冷却均独立 | [ ] |

---

## 测试结果汇总

```
测试日期：____-__-__
测试版本：v_._._
测试人：______

总用例数：___
通过：___
失败：___
跳过：___

失败用例：
- [ ] 用例编号：原因

备注：
```

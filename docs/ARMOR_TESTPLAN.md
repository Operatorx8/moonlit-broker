# ARMOR_TESTPLAN.md - 盔甲系统测试清单

> 进游戏怎么验，一次性验证完

---

## 测试环境准备

```bash
# 测试命令（复制到游戏内执行）

# 获取所有头盔
/give @s mysterious_merchant:sentinel_helmet
/give @s mysterious_merchant:silent_oath_helmet
/give @s mysterious_merchant:exile_mask_helmet
/give @s mysterious_merchant:relic_circlet_helmet
/give @s mysterious_merchant:retracer_ornament_helmet

# 获取所有胸甲
/give @s mysterious_merchant:old_market_chestplate
/give @s mysterious_merchant:blood_pact_chestplate
/give @s mysterious_merchant:ghost_god_chestplate
/give @s mysterious_merchant:windbreaker_chestplate
/give @s mysterious_merchant:void_devourer_chestplate

# 召唤测试怪物
/summon zombie ~ ~ ~
/summon creeper ~ ~ ~
/summon enderman ~ ~ ~
/summon skeleton ~ ~ ~
/summon wither_skeleton ~ ~ ~

# 召唤商人（测试交易经验）
/summon wandering_trader ~ ~ ~

# 设置时间/天气
/time set night
/weather clear

# 生命值操作
/effect give @s instant_damage 1 0
/effect give @s instant_health 1 0

# 清除冷却（如有调试命令）
/merchant_armor clear_cooldown @s all
```

---

## 通用测试

### 物品基础

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| A-01 | 物品注册 | `/give` 命令 | 成功获取物品 | [ ] |
| A-02 | 物品名称 | 查看物品 | 显示正确中文名 + 紫色 | [ ] |
| A-03 | 物品 Lore | 查看物品 | 显示英文 Lore + 效果描述 | [ ] |
| A-04 | 物品贴图 | 查看物品 | 正确贴图，非紫黑块 | [ ] |
| A-05 | 穿戴槽位 | 穿戴 | 只能穿戴到头部 | [ ] |
| A-06 | 穿戴模型 | 穿戴并查看 | 角色模型正确显示盔甲 | [ ] |
| A-07 | 护甲值 | 穿戴查看 UI | 护甲 UI +3 | [ ] |

### 生命周期

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| A-08 | 脱下效果消失 | 脱下流亡面甲 | 攻击力加成消失 | [ ] |
| A-09 | 死亡后重置 | 穿戴死亡重生 | 冷却重置，效果消失 | [ ] |
| A-10 | 切换维度 | 穿戴进入下界 | 效果正常工作 | [ ] |
| A-11 | 重进世界 | 断线重连 | 状态正确恢复 | [ ] |

---

## 头盔 1: 哨兵的最后瞭望

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S1-01 | 黑暗触发 | 穿戴，进入光照 ≤7 区域，等待 | 附近怪物发光 | [ ] |
| S1-02 | 明亮不触发 | 穿戴，站在火把旁 | 不触发效果 | [ ] |
| S1-03 | 发光持续时间 | 触发后计时 | 怪物发光约 5 秒 | [ ] |
| S1-04 | 扫描范围 | 在 20 格外放怪物 | 不被标记 | [ ] |
| S1-05 | 扫描范围 | 在 15 格内放怪物 | 被标记 | [ ] |
| S1-06 | 冷却生效 | 触发后立即再次满足条件 | 40 秒内不触发 | [ ] |
| S1-07 | 冷却结束 | 等待 40 秒后 | 可再次触发 | [ ] |
| S1-08 | 未穿戴不触发 | 脱下头盔，进入黑暗 | 不触发 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S1-L1 | 触发成功 | `action=trigger result=OK effect=sentinel_glow` | [ ] |
| S1-L2 | 光照不足 | `result=BLOCKED reason=not_dark` | [ ] |
| S1-L3 | 冷却中 | `result=BLOCKED reason=cd_hit cd_left=xxx` | [ ] |

---

## 头盔 2: 沉默之誓约

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S2-01 | 减伤触发 | 穿戴，被僵尸攻击 | 伤害减少 2 点 | [ ] |
| S2-02 | 低伤害不触发 | 被伤害 < 2 的攻击 | 不触发减伤 | [ ] |
| S2-03 | 非怪物不触发 | 摔落伤害 / 熔岩 | 不触发减伤 | [ ] |
| S2-04 | 激怒怪物触发 | 被激怒的僵尸猪人攻击 | 触发减伤 | [ ] |
| S2-05 | 冷却生效 | 触发后再次受攻击 | 30 秒内不触发 | [ ] |
| S2-06 | 冷却结束 | 等待 30 秒后受攻击 | 再次触发 | [ ] |

### 数值验证

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S2-N1 | 减伤计算 | 被 5 点伤害攻击 | 实际受到 3 点 | [ ] |
| S2-N2 | 最小伤害 | 被 2 点伤害攻击 | 实际受到 0 点 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S2-L1 | 触发成功 | `action=trigger result=OK effect=silent_oath_reduction` | [ ] |
| S2-L2 | 伤害修改 | `action=damage_modify final{amount=3.0} src{original=5.0}` | [ ] |
| S2-L3 | 非敌对 | `result=BLOCKED reason=damage_not_hostile` | [ ] |

---

## 头盔 3: 流亡者的面甲

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S3-01 | 高血量无加成 | 穿戴，满血 | 攻击力不变 | [ ] |
| S3-02 | 低血量有加成 | 穿戴，血量 < 50% | 攻击力增加 | [ ] |
| S3-03 | 加成实时更新 | 持续掉血 | 攻击力随血量下降增加 | [ ] |
| S3-04 | 加成有上限 | 血量降到 10% | 攻击力不超过 +4.0 | [ ] |
| S3-05 | 回血后消失 | 吃东西回血到 50%+ | 攻击力加成消失 | [ ] |
| S3-06 | 脱下后消失 | 脱下头盔 | 攻击力恢复原值 | [ ] |

### 数值验证

| # | 测试项 | 血量% | 预期增伤 | 通过 |
|---|--------|-------|----------|------|
| S3-N1 | 50% | 50% | +0 | [ ] |
| S3-N2 | 42.5% | 42.5% | +1.0 | [ ] |
| S3-N3 | 35% | 35% | +2.0 | [ ] |
| S3-N4 | 27.5% | 27.5% | +3.0 | [ ] |
| S3-N5 | 20% | 20% | +4.0 | [ ] |
| S3-N6 | 10% | 10% | +4.0 (上限) | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S3-L1 | 状态激活 | `state=exile_mask_active enabled=true` | [ ] |
| S3-L2 | 属性更新 | `action=attribute_update attr=generic.attack_damage` | [ ] |
| S3-L3 | 状态解除 | `state=exile_mask_active enabled=false` | [ ] |

---

## 头盔 4: 遗世之环

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S4-01 | 首次锁定触发 | 穿戴，被僵尸首次锁定 | 获得 Absorption | [ ] |
| S4-02 | 持续锁定不触发 | 同一僵尸持续追击 | 不重复触发 | [ ] |
| S4-03 | 护盾持续时间 | 触发后计时 | Absorption 持续约 3 秒 | [ ] |
| S4-04 | 冷却生效 | 触发后被另一僵尸锁定 | 30 秒内不触发 | [ ] |
| S4-05 | 末影人兼容 | 被末影人激怒 | 触发效果 | [ ] |
| S4-06 | 猪灵兼容 | 被猪灵激怒 | 触发效果 | [ ] |

### 边沿触发验证

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S4-E1 | 怪物脱战后重置 | 僵尸失去目标后再次锁定 | 可再次触发（受 CD 限制） | [ ] |
| S4-E2 | 怪物死亡后重置 | 杀死僵尸，新僵尸锁定 | 可触发（受 CD 限制） | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S4-L1 | 触发成功 | `action=trigger result=OK effect=relic_circlet_shield first_target=true` | [ ] |
| S4-L2 | 已触发过 | `result=BLOCKED reason=already_triggered` | [ ] |

---

## 头盔 5: 回溯者的额饰

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S5-01 | 爆炸致死保护 | 穿戴，低血量被苦力怕炸 | 存活，血量 = 1♥ | [ ] |
| S5-02 | 短暂保护 | 触发后 | 有短暂抗性效果 | [ ] |
| S5-03 | 非爆炸不触发 | 被僵尸打致死 | 正常死亡 | [ ] |
| S5-04 | 非致死不触发 | 高血量被爆炸 | 不触发，正常受伤 | [ ] |
| S5-05 | 图腾优先 | 持有图腾，被炸致死 | 图腾触发，额饰不触发 | [ ] |
| S5-06 | 无图腾时触发 | 不持图腾，被炸致死 | 额饰触发 | [ ] |
| S5-07 | 冷却生效 | 触发后再次被炸致死 | 15 分钟内正常死亡 | [ ] |
| S5-08 | 音效/粒子 | 触发时 | 有独特音效和粒子 | [ ] |

### 爆炸类型测试

| # | 测试项 | 爆炸来源 | 预期结果 | 通过 |
|---|--------|----------|----------|------|
| S5-E1 | 苦力怕 | Creeper | 触发保护 | [ ] |
| S5-E2 | TNT | TNT | 触发保护 | [ ] |
| S5-E3 | 床（下界） | Bed | 触发保护 | [ ] |
| S5-E4 | 水晶 | End Crystal | 触发保护 | [ ] |
| S5-E5 | 凋灵骷髅头 | Wither Skull | 触发保护 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S5-L1 | 触发成功 | `action=trigger result=OK effect=retracer_save dmg_type=explosion` | [ ] |
| S5-L2 | 死亡阻止 | `action=apply effect=death_prevention final{health_set=2.0}` | [ ] |
| S5-L3 | 图腾优先 | `result=BLOCKED reason=totem_active` | [ ] |
| S5-L4 | 非爆炸 | `result=BLOCKED reason=damage_not_explosion` | [ ] |

---

## 胸甲 1: 旧市护甲

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C1-01 | 交易经验触发 | 穿戴，与商人交易 | 有概率获得 1.5 倍经验 | [ ] |
| C1-02 | 交易首次限定 | 同一交易槽再次交易 | 不再触发加成 | [ ] |
| C1-03 | 交易 CD | 触发后换交易槽交易 | 60s 内不触发 | [ ] |
| C1-04 | 击杀经验触发 | 穿戴，击杀怪物 | 有概率获得 2 倍经验 | [ ] |
| C1-05 | 击杀 CD | 触发后再击杀 | 30s 内不触发 | [ ] |
| C1-06 | 经验瓶不触发 | 使用经验瓶 | 不触发加成 | [ ] |
| C1-07 | 独立 CD | 交易触发后立即击杀 | 击杀可独立触发 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| C1-L1 | 交易触发 | `action=trigger result=OK effect=trade_xp_bonus` | [ ] |
| C1-L2 | 击杀触发 | `action=trigger result=OK effect=kill_xp_bonus` | [ ] |
| C1-L3 | 首次限定 | `result=BLOCKED reason=trade_already_triggered` | [ ] |

---

## 胸甲 2: 流血契约之胸铠

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C2-01 | 储能触发 | 穿戴，被僵尸攻击 | 有概率额外扣血并储能 | [ ] |
| C2-02 | 储能上限 | 多次被攻击 | 池不超过 4♥ | [ ] |
| C2-03 | 释放伤害 | 储能后攻击怪物 | 造成额外伤害 | [ ] |
| C2-04 | 窗口过期 | 储能后等待 10s+ | 储能清空 | [ ] |
| C2-05 | 摔落不触发 | 摔落受伤 | 不触发储能 | [ ] |
| C2-06 | 熔岩不触发 | 熔岩受伤 | 不触发储能 | [ ] |
| C2-07 | 远程触发 | 被骷髅射击 | 正常触发储能 | [ ] |

### 数值验证

| # | 测试项 | 受伤量 | 预期储能 | 通过 |
|---|--------|--------|----------|------|
| C2-N1 | 低伤害 | 4 HP | 2.0 HP | [ ] |
| C2-N2 | 高伤害 | 10 HP | 4.0 HP (上限) | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| C2-L1 | 储能 | `action=trigger result=OK effect=blood_pact_charge` | [ ] |
| C2-L2 | 释放 | `action=trigger result=OK effect=blood_pact_release` | [ ] |
| C2-L3 | 过期 | `action=state_change state=blood_pool_expired` | [ ] |

---

## 胸甲 3: 鬼神之铠

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C3-01 | 亡灵减伤 | 穿戴，被僵尸攻击 | 有概率减少 15% 伤害 | [ ] |
| C3-02 | 非亡灵不减伤 | 被蜘蛛攻击 | 不触发减伤 | [ ] |
| C3-03 | Wither 免疫 | 被凋灵骷髅攻击 | 有概率免疫凋零效果 | [ ] |
| C3-04 | Hunger 免疫 | 被尸壳攻击 | 有概率免疫饥饿效果 | [ ] |
| C3-05 | Slowness 免疫 | 测试减速来源 | 有概率免疫 | [ ] |
| C3-06 | Boss 概率减半 | 被凋灵攻击 | 减伤概率降为 15% | [ ] |
| C3-07 | 其他 Debuff 正常 | 被女巫攻击（中毒） | 正常中毒 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| C3-L1 | 减伤触发 | `action=trigger result=OK effect=undead_damage_reduction` | [ ] |
| C3-L2 | 免疫触发 | `action=trigger result=OK effect=undead_debuff_immune` | [ ] |
| C3-L3 | 非亡灵 | `result=BLOCKED reason=not_undead` | [ ] |

---

## 胸甲 4: 商人的防风衣

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C4-01 | 击退抗性 | 穿戴，被怪物攻击 | 击退距离明显减少 | [ ] |
| C4-02 | 低血速度触发 | 从满血降到 <50% | 获得 Speed I 5s | [ ] |
| C4-03 | 边沿触发 | 血量卡在 49% | 不重复触发 | [ ] |
| C4-04 | CD 生效 | 触发后立即回血再掉血 | 90s 内不触发 | [ ] |
| C4-05 | 重新武装 | 血量回到 60%+ 后再掉血 | 可再次触发 | [ ] |
| C4-06 | 未回满不触发 | 血量回到 55% 后再掉血 | 不触发 | [ ] |

### 边沿触发验证

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C4-E1 | 从 52%→48% | 一次性掉血跨阈值 | 触发一次 | [ ] |
| C4-E2 | 从 70%→30% | 大量掉血跨阈值 | 触发一次 | [ ] |
| C4-E3 | 持续低血 | 保持 40% 血量 | 不触发 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| C4-L1 | 触发 | `action=trigger result=OK effect=low_health_speed edge{...}` | [ ] |
| C4-L2 | 重新武装 | `action=state_change state=rearm_ready enabled=true` | [ ] |

---

## 胸甲 5: 虚空之噬

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C5-01 | 真伤触发 | 穿戴，攻击怪物 | 造成额外 4% 真伤 | [ ] |
| C5-02 | CD 生效 | 5s 内再次攻击 | 不触发真伤 | [ ] |
| C5-03 | CD 结束 | 5s 后再次攻击 | 再次触发 | [ ] |
| C5-04 | Boss 减半 | 攻击凋灵 | 仅造成 2% 真伤 | [ ] |
| C5-05 | 绕过护甲 | 攻击高护甲目标 | 真伤部分不受护甲影响 | [ ] |

### 数值验证

| # | 测试项 | 基础伤害 | 真伤 | 通过 |
|---|--------|----------|------|------|
| C5-N1 | 普通目标 | 6.0 | 0.24 | [ ] |
| C5-N2 | Boss | 6.0 | 0.12 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| C5-L1 | 触发 | `action=trigger result=OK effect=void_bite` | [ ] |
| C5-L2 | Boss | `action=trigger result=OK effect=void_bite boss_modifier=true` | [ ] |
| C5-L3 | CD | `result=BLOCKED reason=cd_hit` | [ ] |

---

## 边界情况

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| E-01 | 快速切换头盔 | 战斗中切换不同头盔 | 效果正确切换，无残留 | [ ] |
| E-02 | 与原版附魔共存 | 附魔保护 IV | 两者效果叠加 | [ ] |
| E-03 | 与药水共存 | 喝力量药水 + 流亡面甲 | 攻击力正确叠加 | [ ] |
| E-04 | 多人同时穿戴 | 两玩家穿同款头盔 | 各自独立触发 | [ ] |

---

## 测试结果汇总

```
测试日期：____-__-__
测试版本：v_._._
测试人：______

总用例数：___
通过：___
失败：___
跳过：___

失败用例：
- [ ] 用例编号：原因

备注：
```

# ARMOR_TESTPLAN.md - 盔甲系统测试清单

> 进游戏怎么验，一次性验证完

---

## 测试环境准备

```bash
# 测试命令（复制到游戏内执行）

# 获取所有头盔
/give @s mymodtest:sentinel_helmet
/give @s mymodtest:silent_oath_helmet
/give @s mymodtest:exile_mask_helmet
/give @s mymodtest:relic_circlet_helmet
/give @s mymodtest:retracer_ornament_helmet

# 召唤测试怪物
/summon zombie ~ ~ ~
/summon creeper ~ ~ ~
/summon enderman ~ ~ ~

# 设置时间/天气
/time set night
/weather clear

# 生命值操作
/effect give @s instant_damage 1 0
/effect give @s instant_health 1 0

# 清除冷却（如有调试命令）
/merchant_armor clear_cooldown @s all
```

---

## 通用测试

### 物品基础

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| A-01 | 物品注册 | `/give` 命令 | 成功获取物品 | [ ] |
| A-02 | 物品名称 | 查看物品 | 显示正确中文名 + 紫色 | [ ] |
| A-03 | 物品 Lore | 查看物品 | 显示英文 Lore + 效果描述 | [ ] |
| A-04 | 物品贴图 | 查看物品 | 正确贴图，非紫黑块 | [ ] |
| A-05 | 穿戴槽位 | 穿戴 | 只能穿戴到头部 | [ ] |
| A-06 | 穿戴模型 | 穿戴并查看 | 角色模型正确显示盔甲 | [ ] |
| A-07 | 护甲值 | 穿戴查看 UI | 护甲 UI +3 | [ ] |

### 生命周期

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| A-08 | 脱下效果消失 | 脱下流亡面甲 | 攻击力加成消失 | [ ] |
| A-09 | 死亡后重置 | 穿戴死亡重生 | 冷却重置，效果消失 | [ ] |
| A-10 | 切换维度 | 穿戴进入下界 | 效果正常工作 | [ ] |
| A-11 | 重进世界 | 断线重连 | 状态正确恢复 | [ ] |

---

## 头盔 1: 哨兵的最后瞭望

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S1-01 | 黑暗触发 | 穿戴，进入光照 ≤7 区域，等待 | 附近怪物发光 | [ ] |
| S1-02 | 明亮不触发 | 穿戴，站在火把旁 | 不触发效果 | [ ] |
| S1-03 | 发光持续时间 | 触发后计时 | 怪物发光约 5 秒 | [ ] |
| S1-04 | 扫描范围 | 在 20 格外放怪物 | 不被标记 | [ ] |
| S1-05 | 扫描范围 | 在 15 格内放怪物 | 被标记 | [ ] |
| S1-06 | 冷却生效 | 触发后立即再次满足条件 | 40 秒内不触发 | [ ] |
| S1-07 | 冷却结束 | 等待 40 秒后 | 可再次触发 | [ ] |
| S1-08 | 未穿戴不触发 | 脱下头盔，进入黑暗 | 不触发 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S1-L1 | 触发成功 | `action=trigger result=OK effect=sentinel_glow` | [ ] |
| S1-L2 | 光照不足 | `result=BLOCKED reason=not_dark` | [ ] |
| S1-L3 | 冷却中 | `result=BLOCKED reason=cd_hit cd_left=xxx` | [ ] |

---

## 头盔 2: 沉默之誓约

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S2-01 | 减伤触发 | 穿戴，被僵尸攻击 | 伤害减少 2 点 | [ ] |
| S2-02 | 低伤害不触发 | 被伤害 < 2 的攻击 | 不触发减伤 | [ ] |
| S2-03 | 非怪物不触发 | 摔落伤害 / 熔岩 | 不触发减伤 | [ ] |
| S2-04 | 激怒怪物触发 | 被激怒的僵尸猪人攻击 | 触发减伤 | [ ] |
| S2-05 | 冷却生效 | 触发后再次受攻击 | 30 秒内不触发 | [ ] |
| S2-06 | 冷却结束 | 等待 30 秒后受攻击 | 再次触发 | [ ] |

### 数值验证

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S2-N1 | 减伤计算 | 被 5 点伤害攻击 | 实际受到 3 点 | [ ] |
| S2-N2 | 最小伤害 | 被 2 点伤害攻击 | 实际受到 0 点 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S2-L1 | 触发成功 | `action=trigger result=OK effect=silent_oath_reduction` | [ ] |
| S2-L2 | 伤害修改 | `action=damage_modify final{amount=3.0} src{original=5.0}` | [ ] |
| S2-L3 | 非敌对 | `result=BLOCKED reason=damage_not_hostile` | [ ] |

---

## 头盔 3: 流亡者的面甲

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S3-01 | 高血量无加成 | 穿戴，满血 | 攻击力不变 | [ ] |
| S3-02 | 低血量有加成 | 穿戴，血量 < 50% | 攻击力增加 | [ ] |
| S3-03 | 加成实时更新 | 持续掉血 | 攻击力随血量下降增加 | [ ] |
| S3-04 | 加成有上限 | 血量降到 10% | 攻击力不超过 +4.0 | [ ] |
| S3-05 | 回血后消失 | 吃东西回血到 50%+ | 攻击力加成消失 | [ ] |
| S3-06 | 脱下后消失 | 脱下头盔 | 攻击力恢复原值 | [ ] |

### 数值验证

| # | 测试项 | 血量% | 预期增伤 | 通过 |
|---|--------|-------|----------|------|
| S3-N1 | 50% | 50% | +0 | [ ] |
| S3-N2 | 42.5% | 42.5% | +1.0 | [ ] |
| S3-N3 | 35% | 35% | +2.0 | [ ] |
| S3-N4 | 27.5% | 27.5% | +3.0 | [ ] |
| S3-N5 | 20% | 20% | +4.0 | [ ] |
| S3-N6 | 10% | 10% | +4.0 (上限) | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S3-L1 | 状态激活 | `state=exile_mask_active enabled=true` | [ ] |
| S3-L2 | 属性更新 | `action=attribute_update attr=generic.attack_damage` | [ ] |
| S3-L3 | 状态解除 | `state=exile_mask_active enabled=false` | [ ] |

---

## 头盔 4: 遗世之环

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S4-01 | 首次锁定触发 | 穿戴，被僵尸首次锁定 | 获得 Absorption | [ ] |
| S4-02 | 持续锁定不触发 | 同一僵尸持续追击 | 不重复触发 | [ ] |
| S4-03 | 护盾持续时间 | 触发后计时 | Absorption 持续约 3 秒 | [ ] |
| S4-04 | 冷却生效 | 触发后被另一僵尸锁定 | 30 秒内不触发 | [ ] |
| S4-05 | 末影人兼容 | 被末影人激怒 | 触发效果 | [ ] |
| S4-06 | 猪灵兼容 | 被猪灵激怒 | 触发效果 | [ ] |

### 边沿触发验证

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S4-E1 | 怪物脱战后重置 | 僵尸失去目标后再次锁定 | 可再次触发（受 CD 限制） | [ ] |
| S4-E2 | 怪物死亡后重置 | 杀死僵尸，新僵尸锁定 | 可触发（受 CD 限制） | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S4-L1 | 触发成功 | `action=trigger result=OK effect=relic_circlet_shield first_target=true` | [ ] |
| S4-L2 | 已触发过 | `result=BLOCKED reason=already_triggered` | [ ] |

---

## 头盔 5: 回溯者的额饰

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S5-01 | 爆炸致死保护 | 穿戴，低血量被苦力怕炸 | 存活，血量 = 1♥ | [ ] |
| S5-02 | 短暂保护 | 触发后 | 有短暂抗性效果 | [ ] |
| S5-03 | 非爆炸不触发 | 被僵尸打致死 | 正常死亡 | [ ] |
| S5-04 | 非致死不触发 | 高血量被爆炸 | 不触发，正常受伤 | [ ] |
| S5-05 | 图腾优先 | 持有图腾，被炸致死 | 图腾触发，额饰不触发 | [ ] |
| S5-06 | 无图腾时触发 | 不持图腾，被炸致死 | 额饰触发 | [ ] |
| S5-07 | 冷却生效 | 触发后再次被炸致死 | 15 分钟内正常死亡 | [ ] |
| S5-08 | 音效/粒子 | 触发时 | 有独特音效和粒子 | [ ] |

### 爆炸类型测试

| # | 测试项 | 爆炸来源 | 预期结果 | 通过 |
|---|--------|----------|----------|------|
| S5-E1 | 苦力怕 | Creeper | 触发保护 | [ ] |
| S5-E2 | TNT | TNT | 触发保护 | [ ] |
| S5-E3 | 床（下界） | Bed | 触发保护 | [ ] |
| S5-E4 | 水晶 | End Crystal | 触发保护 | [ ] |
| S5-E5 | 凋灵骷髅头 | Wither Skull | 触发保护 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S5-L1 | 触发成功 | `action=trigger result=OK effect=retracer_save dmg_type=explosion` | [ ] |
| S5-L2 | 死亡阻止 | `action=apply effect=death_prevention final{health_set=2.0}` | [ ] |
| S5-L3 | 图腾优先 | `result=BLOCKED reason=totem_active` | [ ] |
| S5-L4 | 非爆炸 | `result=BLOCKED reason=damage_not_explosion` | [ ] |

---

## 边界情况

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| E-01 | 快速切换头盔 | 战斗中切换不同头盔 | 效果正确切换，无残留 | [ ] |
| E-02 | 与原版附魔共存 | 附魔保护 IV | 两者效果叠加 | [ ] |
| E-03 | 与药水共存 | 喝力量药水 + 流亡面甲 | 攻击力正确叠加 | [ ] |
| E-04 | 多人同时穿戴 | 两玩家穿同款头盔 | 各自独立触发 | [ ] |

---

## 测试结果汇总

```
测试日期：____-__-__
测试版本：v_._._
测试人：______

总用例数：___
通过：___
失败：___
跳过：___

失败用例：
- [ ] 用例编号：原因

备注：
```

# ARMOR_TESTPLAN.md - 盔甲系统测试清单

> 进游戏怎么验，一次性验证完

---

## 测试环境准备

```bash
# 测试命令（复制到游戏内执行）

# 获取所有头盔
/give @s mymodtest:sentinel_helmet
/give @s mymodtest:silent_oath_helmet
/give @s mymodtest:exile_mask_helmet
/give @s mymodtest:relic_circlet_helmet
/give @s mymodtest:retracer_ornament_helmet

# 获取所有胸甲
/give @s mymodtest:old_market_chestplate
/give @s mymodtest:blood_pact_chestplate
/give @s mymodtest:ghost_god_chestplate
/give @s mymodtest:windbreaker_chestplate
/give @s mymodtest:void_devourer_chestplate

# 召唤测试怪物
/summon zombie ~ ~ ~
/summon skeleton ~ ~ ~
/summon creeper ~ ~ ~
/summon enderman ~ ~ ~
/summon wither_skeleton ~ ~ ~

# 设置时间/天气
/time set night
/weather clear

# 生命值操作
/effect give @s instant_damage 1 0
/effect give @s instant_health 1 0

# 交易测试
/summon wandering_trader ~ ~ ~

# 清除冷却（如有调试命令）
/merchant_armor clear_cooldown @s all
```

---

## 通用测试

### 物品基础

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| A-01 | 物品注册 | `/give` 命令 | 成功获取物品 | [ ] |
| A-02 | 物品名称 | 查看物品 | 显示正确中文名 + 与 rarity 匹配的名称颜色 | [ ] |
| A-03 | 物品 Lore | 查看物品 | 显示英文 Lore + 效果描述 | [ ] |
| A-04 | 物品贴图 | 查看物品 | 正确贴图，非紫黑块 | [ ] |
| A-05 | 穿戴槽位 | 穿戴 | 只能穿戴到头部 | [ ] |
| A-06 | 穿戴模型 | 穿戴并查看 | 角色模型正确显示盔甲 | [ ] |
| A-07 | 护甲值 | 穿戴查看 UI | 护甲 UI +3 | [ ] |

### 附魔系数验收（enchantability）

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| A-E01 | UNCOMMON 档位 | 用 `sentinel_helmet` 与原版铁头盔在附魔台各附魔 10 次 | 可选附魔等级与高等级词条出现频率接近 | [ ] |
| A-E02 | RARE 档位 | 用 `silent_oath_helmet`（或 `exile_mask_helmet`）与原版锁链头盔对照附魔 | 结果分布接近锁链头盔 | [ ] |
| A-E03 | EPIC 档位 | 用 `retracer_ornament_helmet` 与原版下界合金头盔对照附魔 | 结果分布接近下界合金头盔 | [ ] |
| A-E04 | 铁砧边界 | 给上述头盔附同一本附魔书并比较铁砧花费 | 花费由附魔/修复规则决定，不受 enchantability 直接影响 | [ ] |

### 生命周期

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| A-08 | 脱下效果消失 | 脱下流亡面甲 | 攻击力加成消失 | [ ] |
| A-09 | 死亡后重置 | 穿戴死亡重生 | 冷却重置，效果消失 | [ ] |
| A-10 | 切换维度 | 穿戴进入下界 | 效果正常工作 | [ ] |
| A-11 | 重进世界 | 断线重连 | 状态正确恢复 | [ ] |

---

## 头盔 1: 哨兵的最后瞭望

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S1-01 | 黑暗 + 敌对触发 | 穿戴，光照 ≤7，16 格内放敌对生物并等待扫描 | 玩家获得 Speed I（约 1.5s）并听到提示音；敌对生物无 Glowing 轮廓 | [ ] |
| S1-02 | 冷却生效 | 首次触发后 40 秒内反复满足条件 | 不重复触发（无重复音效/无重复 Speed） | [ ] |
| S1-03 | 非黑暗不触发 | 穿戴，站在明亮环境（光照 > 7），附近有敌对 | 不触发 | [ ] |
| S1-04 | 无敌对不触发 | 穿戴，光照 ≤7，但 16 格内无敌对 | 不触发 | [ ] |
| S1-05 | 触发范围边界 | 敌对在 17 格外 | 不触发 | [ ] |
| S1-06 | 触发范围边界 | 敌对在 16 格内 | 触发 Echo Pulse | [ ] |
| S1-07 | 性能频率 | 观察日志时间戳或 tick 计数 | 扫描频率为每 20 ticks（或更低），不得每 tick 全量扫描 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S1-L1 | 触发成功 | `action=trigger result=OK effect=sentinel_echo_pulse` | [ ] |
| S1-L2 | 光照不足 | `result=BLOCKED reason=not_dark` | [ ] |
| S1-L3 | 冷却中 | `result=BLOCKED reason=cd_hit cd_left=xxx` | [ ] |
| S1-L4 | 应用成功 | `action=apply result=OK effect=speed final{dur=30 amp=0} sound=minecraft:block.bell.use` | [ ] |

---

## 头盔 2: 沉默之誓约

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S2-01 | 减伤触发 | 穿戴，被僵尸攻击 | 伤害减少 2 点 | [ ] |
| S2-02 | 低伤害不触发 | 被伤害 < 2 的攻击 | 不触发减伤 | [ ] |
| S2-03 | 非怪物不触发 | 摔落伤害 / 熔岩 | 不触发减伤 | [ ] |
| S2-04 | 激怒怪物触发 | 被激怒的僵尸猪人攻击 | 触发减伤 | [ ] |
| S2-05 | 冷却生效 | 触发后再次受攻击 | 30 秒内不触发 | [ ] |
| S2-06 | 冷却结束 | 等待 30 秒后受攻击 | 再次触发 | [ ] |

### 数值验证

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S2-N1 | 减伤计算 | 被 5 点伤害攻击 | 实际受到 3 点 | [ ] |
| S2-N2 | 最小伤害 | 被 2 点伤害攻击 | 实际受到 0 点 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S2-L1 | 触发成功 | `action=trigger result=OK effect=silent_oath_reduction` | [ ] |
| S2-L2 | 伤害修改 | `action=damage_modify final{amount=3.0} src{original=5.0}` | [ ] |
| S2-L3 | 非敌对 | `result=BLOCKED reason=damage_not_hostile` | [ ] |

---

## 头盔 3: 流亡者的面甲

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S3-01 | 高血量无加成 | 穿戴，满血 | 攻击力不变 | [ ] |
| S3-02 | 低血量有加成 | 穿戴，血量 < 50% | 攻击力增加 | [ ] |
| S3-03 | 加成实时更新 | 持续掉血 | 攻击力随血量下降增加 | [ ] |
| S3-04 | 加成有上限 | 血量降到 10% | 攻击力不超过 +4.0 | [ ] |
| S3-05 | 回血后消失 | 吃东西回血到 50%+ | 攻击力加成消失 | [ ] |
| S3-06 | 脱下后消失 | 脱下头盔 | 攻击力恢复原值 | [ ] |

### 数值验证

| # | 测试项 | 血量% | 预期增伤 | 通过 |
|---|--------|-------|----------|------|
| S3-N1 | 50% | 50% | +0 | [ ] |
| S3-N2 | 42.5% | 42.5% | +1.0 | [ ] |
| S3-N3 | 35% | 35% | +2.0 | [ ] |
| S3-N4 | 27.5% | 27.5% | +3.0 | [ ] |
| S3-N5 | 20% | 20% | +4.0 | [ ] |
| S3-N6 | 10% | 10% | +4.0 (上限) | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S3-L1 | 状态激活 | `state=exile_mask_active enabled=true` | [ ] |
| S3-L2 | 属性更新 | `action=attribute_update attr=generic.attack_damage` | [ ] |
| S3-L3 | 状态解除 | `state=exile_mask_active enabled=false` | [ ] |

---

## 头盔 4: 遗世之环

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S4-01 | 首次锁定触发 | 穿戴，被僵尸首次锁定 | 获得 Absorption | [ ] |
| S4-02 | 持续锁定不触发 | 同一僵尸持续追击 | 不重复触发 | [ ] |
| S4-03 | 护盾持续时间 | 触发后计时 | Absorption 持续约 3 秒 | [ ] |
| S4-04 | 冷却生效 | 触发后被另一僵尸锁定 | 30 秒内不触发 | [ ] |
| S4-05 | 末影人兼容 | 被末影人激怒 | 触发效果 | [ ] |
| S4-06 | 猪灵兼容 | 被猪灵激怒 | 触发效果 | [ ] |

### 边沿触发验证

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S4-E1 | 怪物脱战后重置 | 僵尸失去目标后再次锁定 | 可再次触发（受 CD 限制） | [ ] |
| S4-E2 | 怪物死亡后重置 | 杀死僵尸，新僵尸锁定 | 可触发（受 CD 限制） | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S4-L1 | 触发成功 | `action=trigger result=OK effect=relic_circlet_shield first_target=true` | [ ] |
| S4-L2 | 已触发过 | `result=BLOCKED reason=already_triggered` | [ ] |

---

## 头盔 5: 回溯者的额饰

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| S5-01 | 爆炸致死保护 | 穿戴，低血量被苦力怕炸 | 存活，血量 = 1♥ | [ ] |
| S5-02 | 短暂保护 | 触发后 | 有短暂抗性效果 | [ ] |
| S5-03 | 非爆炸不触发 | 被僵尸打致死 | 正常死亡 | [ ] |
| S5-04 | 非致死不触发 | 高血量被爆炸 | 不触发，正常受伤 | [ ] |
| S5-05 | 图腾优先 | 持有图腾，被炸致死 | 图腾触发，额饰不触发 | [ ] |
| S5-06 | 无图腾时触发 | 不持图腾，被炸致死 | 额饰触发 | [ ] |
| S5-07 | 冷却生效 | 触发后再次被炸致死 | 15 分钟内正常死亡 | [ ] |
| S5-08 | 音效/粒子 | 触发时 | 有独特音效和粒子 | [ ] |

### 爆炸类型测试

| # | 测试项 | 爆炸来源 | 预期结果 | 通过 |
|---|--------|----------|----------|------|
| S5-E1 | 苦力怕 | Creeper | 触发保护 | [ ] |
| S5-E2 | TNT | TNT | 触发保护 | [ ] |
| S5-E3 | 床（下界） | Bed | 触发保护 | [ ] |
| S5-E4 | 水晶 | End Crystal | 触发保护 | [ ] |
| S5-E5 | 凋灵骷髅头 | Wither Skull | 触发保护 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| S5-L1 | 触发成功 | `action=trigger result=OK effect=retracer_save dmg_type=explosion` | [ ] |
| S5-L2 | 死亡阻止 | `action=apply effect=death_prevention final{health_set=2.0}` | [ ] |
| S5-L3 | 图腾优先 | `result=BLOCKED reason=totem_active` | [ ] |
| S5-L4 | 非爆炸 | `result=BLOCKED reason=damage_not_explosion` | [ ] |

---

---

## 胸甲 1: 旧市护甲

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C1-01 | 交易经验触发 | 穿戴，与商人完成首次交易 | 50% 概率获得额外 50% 经验 | [ ] |
| C1-02 | 交易首次槽限定 | 同一交易槽重复交易 | 仅首次可触发，后续不触发 | [ ] |
| C1-03 | 交易冷却 | 触发后 60s 内完成其他交易槽 | CD 期间不触发 | [ ] |
| C1-04 | 击杀经验触发 | 穿戴，击杀怪物 | 25% 概率获得额外 100% 经验 | [ ] |
| C1-05 | 击杀冷却 | 触发后 30s 内再次击杀 | CD 期间不触发 | [ ] |
| C1-06 | 双通道独立 | 交易触发后立即击杀 | 击杀通道不受交易 CD 影响 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| C1-L1 | 交易触发 | `effect=old_market_trade_xp rng{...hit=YES}` | [ ] |
| C1-L2 | 击杀触发 | `effect=old_market_kill_xp rng{...hit=YES}` | [ ] |
| C1-L3 | 交易已触发 | `reason=trade_already_triggered` | [ ] |

---

## 胸甲 2: 流血契约之胸铠

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C2-01 | 受击储能 | 穿戴，被怪物攻击 | 50% 概率额外扣血并储能 | [ ] |
| C2-02 | 储能上限 | 连续受击多次 | 池不超过 4♥ (8.0 HP) | [ ] |
| C2-03 | 攻击释放 | 储能后攻击怪物 | 池中伤害追加到攻击 | [ ] |
| C2-04 | 释放后清空 | 攻击后查看池 | 池归零 | [ ] |
| C2-05 | 窗口过期 | 储能后等待 10s+ 再攻击 | 池过期清空，不追加伤害 | [ ] |
| C2-06 | 伤害源限定 | 被火焰/熔岩/爆炸伤害 | 不触发储能 | [ ] |

### 数值验证

| # | 测试项 | 原始伤害 | 额外扣血 | 池增加 | 通过 |
|---|--------|----------|----------|--------|------|
| C2-N1 | 普通伤害 | 6.0 | 3.0 (50%) | +3.0 | [ ] |
| C2-N2 | 高伤害 | 10.0 | 4.0 (上限 2♥) | +4.0 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| C2-L1 | 储能成功 | `effect=blood_pact extra_dmg=X pool{...}` | [ ] |
| C2-L2 | 释放成功 | `effect=blood_pact_release pool=X` | [ ] |
| C2-L3 | 池过期 | `reason=pool_expired` | [ ] |

---

## 胸甲 3: 鬼神之铠

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C3-01 | 亡灵减伤 | 穿戴，被僵尸攻击 | 30% 概率伤害 -15% | [ ] |
| C3-02 | 非亡灵不触发 | 被蜘蛛攻击 | 不触发减伤 | [ ] |
| C3-03 | Boss 概率减半 | 被凋灵攻击 | 15% 概率减伤 | [ ] |
| C3-04 | Wither Debuff 免疫 | 被凋灵骷髅施加凋零 | 50% 概率免疫 | [ ] |
| C3-05 | Hunger Debuff 免疫 | 被亡灵施加饥饿 | 50% 概率免疫 | [ ] |
| C3-06 | Slowness Debuff 免疫 | 被亡灵施加缓慢 | 50% 概率免疫 | [ ] |
| C3-07 | Boss Debuff 概率减半 | 被凋灵施加凋零 | 25% 概率免疫 | [ ] |
| C3-08 | 非亡灵 Debuff 不免疫 | 被女巫施加缓慢 | 不触发免疫 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| C3-L1 | 减伤触发 | `effect=ghost_god_damage rng{...hit=YES}` | [ ] |
| C3-L2 | Debuff 免疫 | `effect=ghost_god_debuff debuff=wither` | [ ] |
| C3-L3 | 非亡灵 | `reason=not_undead` | [ ] |

---

## 胸甲 4: 商人的防风衣

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C4-01 | 击退抗性 | 穿戴，被怪物攻击 | 击退距离明显减少 | [ ] |
| C4-02 | 击退抗性值 | F3 查看属性或对比测试 | +0.3 击退抗性 | [ ] |
| C4-03 | 低血边沿触发 | 血量从 ≥50% 跌到 <50% | 获得 Speed I 5s | [ ] |
| C4-04 | 冷却生效 | 触发后回血再掉血 | 90s 内不重复触发 | [ ] |
| C4-05 | 解锁条件 | 触发后血量回到 60%+ | 状态解锁，可再次触发 | [ ] |
| C4-06 | 未解锁不触发 | 触发后血量未回 60%，再次掉到 50% 以下 | 不触发 | [ ] |
| C4-07 | 脱下后移除 | 脱下胸甲 | 击退抗性消失 | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| C4-L1 | 边沿触发 | `effect=windbreaker_speed edge{from=0.5X to=0.4X}` | [ ] |
| C4-L2 | 解锁状态 | `state=rearm_ready enabled=true health_pct=0.6X` | [ ] |
| C4-L3 | 未解锁 | `reason=not_rearmed` | [ ] |

---

## 胸甲 5: 虚空之噬

### 功能测试

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C5-01 | 真伤触发 | 穿戴，攻击怪物 | 追加 4% 真实伤害 | [ ] |
| C5-02 | 冷却生效 | 触发后 5s 内再次攻击 | 不追加真伤 | [ ] |
| C5-03 | 冷却结束 | 等待 5s 后攻击 | 再次追加真伤 | [ ] |
| C5-04 | Boss 比例减半 | 攻击末影龙/凋灵 | 仅追加 2% 真伤 | [ ] |
| C5-05 | 非 LivingEntity 不触发 | 攻击盔甲架/船 | 不触发 | [ ] |

### 数值验证

| # | 测试项 | 基础伤害 | 预期真伤 | 通过 |
|---|--------|----------|----------|------|
| C5-N1 | 普通目标 | 10.0 | 0.4 (4%) | [ ] |
| C5-N2 | Boss 目标 | 10.0 | 0.2 (2%) | [ ] |

### 日志验证

| # | 测试项 | 预期日志 | 通过 |
|---|--------|----------|------|
| C5-L1 | 触发成功 | `effect=void_devourer ctx{...base_dmg=X}` | [ ] |
| C5-L2 | 真伤应用 | `effect=true_damage final{amount=X ratio=0.04}` | [ ] |
| C5-L3 | Boss 模式 | `boss_modifier=true` | [ ] |

---

## 胸甲附魔系数验收

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| C-E01 | UNCOMMON 档位 | `windbreaker_chestplate` 与原版铁胸甲附魔对照 | 分布接近铁甲 | [ ] |
| C-E02 | RARE 档位 | `old_market_chestplate` 与原版锁链胸甲附魔对照 | 分布接近锁链甲 | [ ] |
| C-E03 | EPIC 档位 | `ghost_god_chestplate` 与原版下界合金胸甲附魔对照 | 分布接近下界合金甲 | [ ] |

---

## 边界情况

| # | 测试项 | 操作 | 预期结果 | 通过 |
|---|--------|------|----------|------|
| E-01 | 快速切换头盔 | 战斗中切换不同头盔 | 效果正确切换，无残留 | [ ] |
| E-02 | 与原版附魔共存 | 附魔保护 IV | 两者效果叠加 | [ ] |
| E-03 | 与药水共存 | 喝力量药水 + 流亡面甲 | 攻击力正确叠加 | [ ] |
| E-04 | 多人同时穿戴 | 两玩家穿同款头盔 | 各自独立触发 | [ ] |
| E-05 | 快速切换胸甲 | 战斗中切换不同胸甲 | 效果正确切换，无残留 | [ ] |
| E-06 | 头盔+胸甲组合 | 穿戴流亡面甲 + 血契胸甲 | 两者效果独立工作 | [ ] |
| E-07 | 血契+虚空组合 | 穿血契胸甲击中敌人 | 血契释放和虚空真伤分别生效 | [ ] |

---

## 测试结果汇总

```
测试日期：____-__-__
测试版本：v_._._
测试人：______

总用例数：___
通过：___
失败：___
跳过：___

失败用例：
- [ ] 用例编号：原因

备注：
```
